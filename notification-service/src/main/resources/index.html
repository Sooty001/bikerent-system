<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>BikeRent Notifications</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f0f2f5; }
        .container { max-width: 600px; margin: 0 auto; }
        .card { background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); animation: fadein 0.5s; }
        .level-GOLD { border-left: 5px solid #FFD700; background-color: #FFFDF0; }
        .level-SILVER { border-left: 5px solid #C0C0C0; background-color: #F8F8F8; }
        .level-BRONZE { border-left: 5px solid #CD7F32; background-color: #FFF5EE; }
        .level-STANDARD { border-left: 5px solid #007bff; }

        #status { font-weight: bold; margin-bottom: 20px; color: gray; }
        .connected { color: green !important; }
        .disconnected { color: red !important; }

        @keyframes fadein { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <h2>üö≤ –¶–µ–Ω—Ç—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤–µ–ª–æ–ø—Ä–æ–∫–∞—Ç–∞</h2>
    <div id="status" class="disconnected">üî¥ –û—Ç–∫–ª—é—á–µ–Ω–æ</div>
    <div id="notifications"></div>
</div>

<script>
    const statusDiv = document.getElementById('status');
    const listDiv = document.getElementById('notifications');
    let socket;

    function connect() {
        // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ notification-service (–ø–æ—Ä—Ç 8082)
        socket = new WebSocket('ws://localhost:8082/ws/notifications');

        socket.onopen = () => {
            statusDiv.innerText = 'üü¢ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–∏—Å—Ç–µ–º–µ';
            statusDiv.className = 'connected';
        };

        socket.onmessage = (event) => {
            console.log("–ü—Ä–∏—à–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–µ:", event.data);
            const data = JSON.parse(event.data);

            // –ï—Å–ª–∏ —ç—Ç–æ –Ω–∞—à–µ —Å–æ–±—ã—Ç–∏–µ RentalRatedEvent
            if (data.level) {
                showNotification(data);
            }
        };

        socket.onclose = () => {
            statusDiv.innerText = 'üî¥ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–∑–æ—Ä–≤–∞–Ω–æ. –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
            statusDiv.className = 'disconnected';
            setTimeout(connect, 3000); // –†–µ–∫–æ–Ω–Ω–µ–∫—Ç —á–µ—Ä–µ–∑ 3 —Å–µ–∫
        };
    }

    function showNotification(data) {
        const div = document.createElement('div');
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å —Å—Ç–∏–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è (GOLD, SILVER...)
        div.className = `card level-${data.level}`;

        div.innerHTML = `
            <h3>üèÅ –ê—Ä–µ–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h3>
            <p><strong>–ö–ª–∏–µ–Ω—Ç ID:</strong> ${data.customerId}</p>
            <p><strong>–†–µ–π—Ç–∏–Ω–≥ –ø–æ–µ–∑–¥–∫–∏:</strong> ${data.score} –±–∞–ª–ª–æ–≤</p>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span style="font-size: 1.2em; font-weight: bold;">${data.level}</span></p>
            <small>Rental ID: ${data.rentalId}</small>
        `;
        listDiv.prepend(div); // –î–æ–±–∞–≤–ª—è–µ–º —Å–≤–µ—Ä—Ö—É
    }

    connect();
</script>

</body>
</html>